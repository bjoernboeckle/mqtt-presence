{% raw %}
<div class="card">
  <div class="header">
    <!-- Tabs -->
    <ul class="nav nav-tabs" role="tablist">
      <li class="nav-item">
        <a href="#" class="nav-link" :class="{ active: activeTabRaspi === 'raspistatus' }"
           @click.prevent="activeTabRaspi = 'raspistatus'">
          Raspberry Pi Status {{ raspberryPiStatusIcon }}
        </a>
      </li>
      <li class="nav-item">
        <a href="#" class="nav-link" :class="{ active: activeTabRaspi === 'raspiconfig' }"
           @click.prevent="activeTabRaspi = 'raspiconfig'">
          Config
        </a>
      </li>
    </ul>
  </div>

  <!-- Status -->
  <div class="body p-2" v-show="activeTabRaspi === 'raspistatus'">
    <div v-if="raspberrySwitches.length">
      <div class="fw-bold mb-2">LEDs</div>
      <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-3">
        <div class="col" v-for="([key, item]) in raspberrySwitches" :key="key">
          <div class="form-check form-switch">
            <i :class="mdiClass(item.icon)"></i>
            <input class="form-check-input" type="checkbox" :checked="item.data === 'on'"
                   @change="onToggleSwitch('raspberrypi', key, $event.target.checked)">
            <label class="form-check-label ms-2" v-text="item.friendly_name"></label>
          </div>
        </div>
      </div>
    </div>

    <div v-if="raspberryButtons.length">
      <div class="fw-bold mt-4 mb-2">Buttons</div>
      <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-3">
        <div class="col" v-for="([key, item]) in raspberryButtons" :key="key">
          <button class="btn btn-sm btn-primary w-100 d-flex align-items-center gap-2"
                  @click="sendCommand('/device/command', {
                    'device_key': 'raspberrypi',
                    'data_key': key,
                    'function': item.actions[0]
                  })">
            <i :class="mdiClass(item.icon)"></i>
            <span>{{ item.friendly_name }}</span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Config -->
  <div class="body" v-show="activeTabRaspi === 'raspiconfig'">
    <div class="table-responsive mb-3">
      <table class="table table-sm align-middle">
        <!--<thead class="table-light">
          <tr>
            <th style="width: 40px;"></th>
            <th style="width: 80px;">Pin</th>
            <th>Mode</th>
            <th>Name</th>
          </tr>
        </thead>-->
        <tbody>
          <template v-for="(gpio, index) in config.devices.raspberryPi.gpios" :key="index">
            <tr><td colspan="100%" style="height: 24px; border: none;"></td></tr>
            <tr class="gpio-settings-row">
              <td rowspan="2" style="border-bottom: none !important;">
                <button class="btn btn-sm btn-outline-danger" @click="removeGpio(index)" title="Remove GPIO">❌</button>
              </td>
              <td style="width: 90px;">
                  <label class="form-label form-label-sm">Pin</label>
                  <input type="number" class="form-control form-control-sm" v-model.number="gpio.number" placeholder="Pin" />
              </td>
              <td style="width: 90px;">
                <label class="form-label form-label-sm">Mode</label>
                <select class="form-select form-select-sm" v-model="gpio.mode">
                  <option value="led">LED</option>
                  <option value="button">Button</option>
                </select>
              </td>
              <td>
                <label class="form-label form-label-sm">Name</label>
                <input type="text" class="form-control form-control-sm" v-model="gpio.friendly_name" placeholder="Name" />
              </td>
            </tr>

            <tr class="gpio-settings-row">
              <td style="border-bottom: none !important;"></td>
              <td colspan="2" style="border-bottom: none !important;">
                <!-- Button Settings -->
                <div v-if="gpio.mode === 'button' && gpio.button" class="row g-2">
                  <div class="col-md-2">
                    <label class="form-label form-label-sm mb-1">Bounce (s)</label>
                    <input type="number" step="0.01" class="form-control form-control-sm"
                           v-model.number="gpio.button.bounce_s" />
                  </div>
                  <div class="col-md-1">
                    <label class="form-label form-label-sm mb-1">Pull-Up</label>
                    <div class="form-check form-switch">
                      <input class="form-check-input" type="checkbox" v-model="gpio.button.pull_up" />
                    </div>
                  </div>
                  <div class="col-md-3">
                    <label class="form-label form-label-sm mb-1">Pressed</label>
                    <select class="form-select form-select-sm" v-model="gpio.button.function_pressed">
                      <option :value="null">None</option>
                      <option value="shutdown">Shutdown</option>
                      <option value="reboot">Reboot</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label class="form-label form-label-sm mb-1">Released</label>
                    <select class="form-select form-select-sm" v-model="gpio.button.function_released">
                      <option :value="null">None</option>
                      <option value="shutdown">Shutdown</option>
                      <option value="reboot">Reboot</option>
                    </select>
                  </div>
                  <div class="col-md-3">
                    <label class="form-label form-label-sm mb-1">Held</label>
                    <select class="form-select form-select-sm" v-model="gpio.button.function_held">
                      <option :value="null">None</option>
                      <option value="shutdown">Shutdown</option>
                      <option value="reboot">Reboot</option>
                    </select>
                  </div>
                </div>

                <!-- LED Settings -->
                <div v-if="gpio.mode === 'led' && gpio.led" class="row g-2">
                  <div class="col-md-3">
                    <label class="form-label form-label-sm mb-1">LED Mode</label>
                    <select class="form-select form-select-sm" v-model="gpio.led.led_mode">
                      <option value="onoff">On/Off</option>
                      <option value="blink">Blink</option>
                    </select>
                  </div>
                  <div class="col-md-4">
                    <label class="form-label form-label-sm mb-1">LED Function</label>
                    <select class="form-select form-select-sm" v-model="gpio.led.led_function">
                      <option :value="null">None</option>
                      <option value="running">App running</option>
                      <option value="mqtt-online">MQTT online</option>
                    </select>
                  </div>
                </div>
              </td>
            </tr>
            <tr><td colspan="100%" style="height: 24px;"></td></tr>
          </template>
        </tbody>
      </table>
    </div>

    <div class="text-start mt-3">
      <button class="btn btn-sm btn-outline-primary" @click="addGpio">➕ Add GPIO</button>
    </div>
  </div>
</div>
{% endraw %}