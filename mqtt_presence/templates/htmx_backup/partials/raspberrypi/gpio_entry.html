{% macro render_gpio_entry(gpio, gpio_index) %}
{% set button = gpio.button if gpio.button is defined else {} %}
<div class="row mb-2 align-items-start gpio-entry" data-index="{{ gpio_index }}" id="gpio-{{ gpio_index }}">
  <div class="col-md-2">
    <input type="number" name="gpio_number_{{ gpio_index }}" value="{{ gpio.number }}" class="form-control gpio-number" placeholder="Pin" required>
  </div>
  <div class="col-md-3">
    <input type="text" name="gpio_name_{{ gpio_index }}" value="{{ gpio.friendly_name }}" class="form-control gpio-name" placeholder="Name" required>
  </div>
  <div class="col-md-3">
    <select name="gpio_mode_{{ gpio_index }}" class="form-select gpio-mode" onchange="toggleButtonSettings(this, {{ gpio_index }})">
      <option value="led" {% if gpio.mode == 'led' %}selected{% endif %}>LED</option>
      <option value="button" {% if gpio.mode == 'button' %}selected{% endif %}>Button</option>
    </select>
  </div>
  <div class="col-md-4">
    <button type="button" class="btn btn-sm btn-danger mb-2" onclick="removeGpio({{ gpio_index }})">❌ Delete</button>

    <div class="gpio-settings" id="button-settings-{{ gpio_index }}" style="display: {% if gpio.mode == 'button' %}block{% else %}none{% endif %};">
      <div class="mb-2">
        <label class="form-label">Debounce (seconds)</label>
        <input type="number" name="bounce_s_{{ gpio_index }}" class="form-control bounce-s" step="0.01"
               value="{{ button.bounce_s | default(0.1) }}">
      </div>
      <div class="form-check mb-2">
        <input class="form-check-input pull-up" type="checkbox" name="pull_up_{{ gpio_index }}"
               {% if button.pull_up | default(true) %}checked{% endif %}>
        <label class="form-check-label">Pull-Up</label>
      </div>
      <div class="row">
        {% for fn in ['pressed', 'released', 'held'] %}
        <div class="col-md-4">
          <label class="form-label">{{ fn }}</label>
          <select class="form-select function-{{ fn }}" name="function_{{ fn }}_{{ gpio_index }}">
            <option value="" {% if button['function_' ~ fn] | default('') == "" %}selected{% endif %}>None</option>
            <option value="shutdown" {% if button['function_' ~ fn] | default('') == "shutdown" %}selected{% endif %}>Shutdown</option>
            <option value="reboot" {% if button['function_' ~ fn] | default('') == "reboot" %}selected{% endif %}>Reboot</option>
          </select>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
</div>
{% endmacro %}
{# Für das HTMX-Partial: Wenn render_gpio_entry gesetzt ist, rendere den Block sofort #}
{% if render_gpio_entry and gpio_index is defined %}
  {{ render_gpio_entry(gpio, gpio_index|int) }}
{% endif %}